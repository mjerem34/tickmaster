!function(e){"use strict";var t=e.tablesorter,o=".tscolsel",a=t.columnSelector={queryAll:"@media only all { [columns] { display: none; } } ",queryBreak:"@media all and (min-width: [size]) { [columns] { display: table-cell; } } ",init:function(t,n,l){var c,r;return c=e(l.columnSelector_layout),c.find("input").add(c.filter("input")).length?(n.$table.addClass(n.namespace.slice(1)+"columnselector"),r=n.selector={$container:e(l.columnSelector_container||"<div>")},r.$style=e("<style></style>").prop("disabled",!0).appendTo("head"),r.$breakpoints=e("<style></style>").prop("disabled",!0).appendTo("head"),r.isInitializing=!0,a.setUpColspan(n,l),a.setupSelector(n,l),l.columnSelector_mediaquery&&a.setupBreakpoints(n,l),r.isInitializing=!1,r.$container.length?a.updateCols(n,l):n.debug&&console.warn("ColumnSelector: >> container not found"),void n.$table.off("refreshColumnSelector"+o).on("refreshColumnSelector"+o,function(e,t,o){a.refreshColumns(this.config,t,o)})):void(n.debug&&console.error("ColumnSelector: >> ERROR: Column Selector aborting, no input found in the layout! ***"))},refreshColumns:function(t,o,n){var l,c,r=e.isArray(n||o),s=t.widgetOptions;if("undefined"!=typeof o&&t.selector.$container.length){if("selectors"===o&&(t.selector.$container.empty(),a.setupSelector(t,s),a.setupBreakpoints(t,s),"undefined"==typeof n&&(n=t.selector.auto)),r)for(c=n||o,e.each(c,function(e,t){c[e]=parseInt(t,10)}),l=0;l<t.columns;l++)t.selector.$container.find("input[data-column="+l+"]").prop("checked",e.inArray(l,c)>=0);a.updateAuto(t,s,t.selector.$container.find('input[data-column="auto"]').prop("checked",n===!0||o===!0||"auto"===o&&n!==!1))}else a.updateBreakpoints(t,s),a.updateCols(t,s);a.adjustColspans(t,s)},setupSelector:function(o,n){var l,c,r,s,u,i,d=o.selector,p=d.$container,m=n.columnSelector_saveColumns&&t.storage,h=m?t.storage(o.table,"tablesorter-columnSelector"):[],f=m?t.storage(o.table,"tablesorter-columnSelector-auto"):{};for(d.auto=e.isEmptyObject(f)||"boolean"!==e.type(f.auto)?n.columnSelector_mediaqueryState:f.auto,d.states=[],d.$column=[],d.$wrapper=[],d.$checkbox=[],l=0;l<o.columns;l++)r=o.$headerIndexed[l],s=r.attr(n.columnSelector_priority)||1,i=r.attr("data-column"),u=t.getColumnData(o.table,o.headers,i),f=t.getData(r,u,"columnSelector"),isNaN(s)&&s.length>0||"disable"===f||n.columnSelector_columns[i]&&"disable"===n.columnSelector_columns[i]||(d.states[i]=h&&"undefined"!=typeof h[i]?h[i]:"undefined"!=typeof n.columnSelector_columns[i]?n.columnSelector_columns[i]:"true"===f||"false"!==f,d.$column[i]=e(this),c=r.attr(n.columnSelector_name)||r.text(),p.length&&(d.$wrapper[i]=e(n.columnSelector_layout.replace(/\{name\}/g,c)).appendTo(p),d.$checkbox[i]=d.$wrapper[i].find("input").add(d.$wrapper[i].filter("input")).attr("data-column",i).toggleClass(n.columnSelector_cssChecked,d.states[i]).prop("checked",d.states[i]).on("change",function(){var t=e(this).attr("data-column");o.selector.states[t]=this.checked,a.updateCols(o,n)}).change()))},setupBreakpoints:function(t,n){var l=t.selector;n.columnSelector_mediaquery&&(l.lastIndex=-1,a.updateBreakpoints(t,n),t.$table.off("updateAll"+o).on("updateAll"+o,function(){a.updateBreakpoints(t,n),a.updateCols(t,n)})),l.$container.length&&(n.columnSelector_mediaquery&&(l.$auto=e(n.columnSelector_layout.replace(/\{name\}/g,n.columnSelector_mediaqueryName)).prependTo(l.$container),l.$auto.find("input").add(l.$auto.filter("input")).attr("data-column","auto").prop("checked",l.auto).toggleClass(n.columnSelector_cssChecked,l.auto).on("change",function(){a.updateAuto(t,n,e(this))}).change()),t.$table.off("update"+o).on("update"+o,function(){a.updateCols(t,n)}))},updateAuto:function(o,n,l){var c=o.selector;c.auto=l.prop("checked")||!1,e.each(c.$checkbox,function(e,t){t&&(t[0].disabled=c.auto,c.$wrapper[e].toggleClass("disabled",c.auto))}),n.columnSelector_mediaquery&&a.updateBreakpoints(o,n),a.updateCols(o,n),o.selector.$popup&&o.selector.$popup.find(".tablesorter-column-selector").html(c.$container.html()).find("input").each(function(){var t=e(this).attr("data-column");e(this).prop("checked","auto"===t?c.auto:c.states[t])}),n.columnSelector_saveColumns&&t.storage&&t.storage(o.$table[0],"tablesorter-columnSelector-auto",{auto:c.auto}),a.adjustColspans(o,n),c.auto&&o.$table.triggerHandler(n.columnSelector_updated)},addSelectors:function(e,t){var o=[],a=" col:nth-child("+t+")";return o.push(e+a+","+e+"_extra_table"+a),a=" tr th:nth-child("+t+")",o.push(e+a+","+e+"_extra_table"+a),a=" tr td:nth-child("+t+")",o.push(e+a+","+e+"_extra_table"+a),o},updateBreakpoints:function(o,n){var l,c,r,s,u=[],i=o.selector,d=o.namespace+"columnselector",p=[],m="";if(n.columnSelector_mediaquery&&!i.auto)return i.$breakpoints.prop("disabled",!0),void i.$style.prop("disabled",!1);if(n.columnSelector_mediaqueryHidden)for(r=0;r<o.columns;r++)c=t.getColumnData(o.table,o.headers,r),u[r+1]="false"===t.getData(o.$headerIndexed[r],c,"columnSelector"),u[r+1]&&(p=p.concat(a.addSelectors(d,r+1)));for(l=0;6>l;l++)s=[],o.$headers.filter("["+n.columnSelector_priority+"="+(l+1)+"]").each(function(){r=parseInt(e(this).attr("data-column"),10)+1,u[r]||(s=s.concat(a.addSelectors(d,r)))}),s.length&&(p=p.concat(s),m+=a.queryBreak.replace(/\[size\]/g,n.columnSelector_breakpoints[l]).replace(/\[columns\]/g,s.join(",")));i.$style&&i.$style.prop("disabled",!0),p.length&&i.$breakpoints.prop("disabled",!1).html(a.queryAll.replace(/\[columns\]/g,p.join(","))+m)},updateCols:function(o,n){if(!(n.columnSelector_mediaquery&&o.selector.auto||o.selector.isInitializing)){var l,c=o.selector,r=[],s=o.namespace+"columnselector";c.$container.find("input[data-column]").filter('[data-column!="auto"]').each(function(){this.checked||(l=parseInt(e(this).attr("data-column"),10)+1,r=r.concat(a.addSelectors(s,l))),e(this).toggleClass(n.columnSelector_cssChecked,this.checked)}),n.columnSelector_mediaquery&&c.$breakpoints.prop("disabled",!0),c.$style&&c.$style.prop("disabled",!1).html(r.length?r.join(",")+" { display: none; }":""),n.columnSelector_saveColumns&&t.storage&&t.storage(o.$table[0],"tablesorter-columnSelector",c.states),a.adjustColspans(o,n),o.$table.triggerHandler(n.columnSelector_updated)}},setUpColspan:function(o,n){var l,c,r,s=e(window),u=!1,i=o.$table.add(e(o.namespace+"_extra_table")).children("thead, tfoot").children("tr").children("th, td"),d=i.length;for(l=0;d>l;l++)c=i[l].colSpan,c>1&&(u=!0,i.eq(l).addClass(o.namespace.slice(1)+"columnselectorHasSpan").attr("data-col-span",c));u&&n.columnSelector_mediaquery&&(r=o.namespace.slice(1)+"columnselector",s.off(r).on("resize"+r,t.window_resize).on("resizeEnd"+r,function(){s.off("resize"+r,t.window_resize),a.adjustColspans(o,n),s.on("resize"+r,t.window_resize)}))},adjustColspans:function(t,o){var a,n,l,c,r,s=t.selector,u=s.auto,i=e(t.namespace+"columnselectorHasSpan"),d=i.length;if(d)for(a=0;d>a;a++){for(l=parseInt(i.eq(a).attr("data-column"),10),c=parseInt(i.eq(a).attr("data-col-span"),10),r=l+c,n=l;r>n;n++)(!u&&s.states[n]===!1||u&&t.$headerIndexed[n]&&!t.$headerIndexed[n].is(":visible"))&&c--;c?i.eq(a).show()[0].colSpan=c:i.eq(a).hide()}},attachTo:function(t,o){t=e(t)[0];var a,n,l,c=t.config,r=e(o);r.length&&c&&(r.find(".tablesorter-column-selector").length||r.append('<span class="tablesorter-column-selector"></span>'),a=c.selector,n=c.widgetOptions,r.find(".tablesorter-column-selector").html(a.$container.html()).find("input").each(function(){var t=e(this).attr("data-column"),o="auto"===t?a.auto:a.states[t];e(this).toggleClass(n.columnSelector_cssChecked,o).prop("checked",o)}),a.$popup=r.on("change","input",function(){l=e(this).toggleClass(n.columnSelector_cssChecked,this.checked).attr("data-column"),a.$container.find('input[data-column="'+l+'"]').prop("checked",this.checked).trigger("change")}))}};t.window_resize=function(){t.timer_resize&&clearTimeout(t.timer_resize),t.timer_resize=setTimeout(function(){e(window).trigger("resizeEnd")},250)},t.addWidget({id:"columnSelector",priority:10,options:{columnSelector_container:null,columnSelector_columns:{},columnSelector_saveColumns:!0,columnSelector_layout:'<label><input type="checkbox">{name}</label>',columnSelector_name:"data-selector-name",columnSelector_mediaquery:!0,columnSelector_mediaqueryName:"Auto: ",columnSelector_mediaqueryState:!0,columnSelector_mediaqueryHidden:!1,columnSelector_breakpoints:["20em","30em","40em","50em","60em","70em"],columnSelector_priority:"data-priority",columnSelector_cssChecked:"checked",columnSelector_updated:"columnUpdate"},init:function(e,t,o,n){a.init(e,o,n)},remove:function(e,t,a,n){var l=t.selector;!n&&l&&(l.$container.empty(),l.$popup&&l.$popup.empty(),l.$style.remove(),l.$breakpoints.remove(),t.$table.off("updateAll"+o+" update"+o))}})}(jQuery);
