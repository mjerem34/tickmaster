!function(t){"use strict";var e=t.tablesorter,n={error:{0:"Infinity result: Divide by zero",1:"Need more than one element to make this calculation",undef:"No elements found"},invalid:function(t,e,r){return console.log(e,n.error[r]),t&&t.widgetOptions.math_none||""},events:"tablesorter-initialized update updateAll updateRows addRows updateCell filterReset ".split(" ").join(".tsmath "),processText:function(t,r){var a=e.getElementText(t,r,n.getCellIndex(r));return a=e.formatFloat(a.replace(/[^\w,. \-()]/g,""),t.table)||0,isNaN(a)?0:a},getRow:function(e,r,a){var i,l=e.widgetOptions,o=[],s=r.closest("tr"),h=s.hasClass(l.filter_filteredRow||"filtered");return a&&(s=s.filter(a)),(a||!h)&&(i=s.children().not("["+l.math_dataAttrib+"=ignore]"),l.math_ignore.length&&(i=i.filter(function(e){return-1===t.inArray(n.getCellIndex(t(this)),l.math_ignore)})),o=i.not(r).map(function(){return n.processText(e,t(this))}).get()),o},getColumn:function(e,r,a,i){var l,o,s,h,u,d,c=e.widgetOptions,f=[],g=r.closest("tr"),p=c.math_dataAttrib,m="["+p+"=ignore]",v=c.filter_filteredRow||"filtered",_=n.getCellIndex(r),b=e.$table.children("tbody").children(),w=["["+p+"^=above]","["+p+"^=below]","["+p+"^=col]","["+p+"^=all]"];if("above"===a)for(h=b.index(g),l=h;l>=0;)s=b.eq(l),d=s.children().filter(w[0]).length,i&&(s=s.filter(i)),o=s.children().filter(function(e){return n.getCellIndex(t(this))===_}),((i||!s.hasClass(v))&&s.not(m).length&&l!==h||d&&l!==h)&&(d?l=0:o.length&&f.push(n.processText(e,o))),l--;else if("below"===a)for(h=b.length,l=b.index(g)+1;h>l&&(s=b.eq(l),!s.children().filter(w[1]).length);l++)i&&(s=s.filter(i)),o=s.children().filter(function(e){return n.getCellIndex(t(this))===_}),(i||!s.hasClass(v))&&s.not(m).length&&o.length&&f.push(n.processText(e,o));else for(u=b.not(m),h=u.length,l=0;h>l;l++)s=u.eq(l),i&&(s=s.filter(i)),o=s.children().filter(function(e){return n.getCellIndex(t(this))===_}),!i&&s.hasClass(v)||!o.not(w.join(",")).length||o.is(r)||f.push(n.processText(e,o));return f},getAll:function(e,r){var a,i,l,o,s,h,u,d,c=[],f=e.widgetOptions,g=f.math_dataAttrib,p="["+g+"=ignore]",m=f.filter_filteredRow||"filtered",v=e.$table.children("tbody").children().not(p);for(s=v.length,o=0;s>o;o++)if(l=v.eq(o),r&&(l=l.filter(r)),r||!l.hasClass(m))for(h=l.children().not(p),d=h.length,u=0;d>u;u++)a=h.eq(u),i=n.getCellIndex(a),!a.filter("["+g+"]").length&&t.inArray(i,f.math_ignore)<0&&c.push(n.processText(e,a));return c},setColumnIndexes:function(n){n.$table.after('<div id="_tablesorter_table_placeholder"></div>');var r=n.$table.detach(),a=1,i=r.children("tbody").children().filter(function(){var e,n,r=t(this),i=r.children("[colspan]").length>0;if(a>1?(a--,i=!0):1>a&&(a=1),r.children("[rowspan]").length>0)for(e=this.cells,n=0;n<e.length;n++)a=Math.max(e[n].rowSpan,a);return i});e.computeColumnIndex(i,n),t("#_tablesorter_table_placeholder").after(r).remove()},getCellIndex:function(t){var e=t.attr("data-column");return"undefined"==typeof e?t[0].cellIndex:parseInt(e,10)},recalculate:function(r,a,i){if(r&&(!a.math_isUpdating||i)){var l,o,s,h,u,d=!1,c={};r.debug&&(o=new Date),i&&n.setColumnIndexes(r),a.math_dataAttrib="data-"+(a.math_data||"math"),s=a.math_dataAttrib,h=r.$tbodies.children("tr").children("["+s+"]"),d=n.mathType(r,h,a.math_priority)||d,h=r.$table.children("."+r.cssInfoBlock+", tfoot").children("tr").children("["+s+"]"),n.mathType(r,h,a.math_priority),h=r.$table.children().children("tr").children("["+s+"^=all]"),u=h.length,h.each(function(e,n){var r=t(n),i=h.eq(e).attr(s+"-filter")||a.math_rowFilter;c[i]=c[i]?c[i].add(r):r}),t.each(c,function(t,e){d=n.mathType(r,e,["all"],t)||d}),d&&(a.math_isUpdating=!0,r.debug&&console[console.group?"group":"log"]("Math widget triggering an update after recalculation"),e.update(r,l,function(){n.updateComplete(r)}),r.debug&&console.log("Math widget update completed"+e.benchmark(o)))}},updateComplete:function(t){var e=t.widgetOptions;e.math_isUpdating&&t.debug&&console.groupEnd&&console.groupEnd(),e.math_isUpdating=!1},mathType:function(r,a,i,l){if(a.length){var o,s=!1,h=r.widgetOptions,u=h.math_dataAttrib,d=e.equations;return"all"===i[0]&&(o=n.getAll(r,l)),r.debug&&console[console.group?"group":"log"]("Tablesorter Math widget recalculation"),t.each(i,function(t,e){var i,c,f,g,p,m=a.filter("["+u+"^="+e+"]"),v=m.length;if(v){for(r.debug&&console[console.group?"group":"log"](e),i=0;v>i;i++)p=m.eq(i),p.parent().hasClass(h.filter_filteredRow||"filtered")||(l=p.attr(u+"-filter")||h.math_rowFilter,f=(p.attr(u)||"").replace(e+"-",""),c="row"===e?n.getRow(r,p,l):"all"===e?o:n.getColumn(r,p,e,l),d[f]&&(c.length?(g=d[f](c,r),r.debug&&console.log(p.attr(u),l?'("'+l+'")':"",c,"=",g)):g=n.invalid(r,f,"mean"===f?0:"undef"),s=n.output(p,r,g,c)||s));r.debug&&console.groupEnd&&console.groupEnd()}}),r.debug&&console.groupEnd&&console.groupEnd(),s}return!1},output:function(t,n,r,a){var i,l=n.widgetOptions,o=!1,s=t.html(),h=t.attr("data-"+l.math_data+"-mask")||l.math_mask,u=e.formatMask(h,r,l.math_wrapPrefix,l.math_wrapSuffix);return"function"==typeof l.math_complete&&(u=l.math_complete(t,l,u,r,a)),u!==!1&&(o=s!==u,t.html(u)),o&&(i=t.closest("tbody"),!i.length||i.hasClass(n.cssInfoBlock)||i.parent()[0]!==n.table)?!1:o}};e.formatMask=function(t,e,n,r){if(!t||isNaN(+e))return e;var a,i,l,o,s,h,u,d,c,f,g,p,m,v,_,b="",w=t.length,x=t.search(/[0-9\-\+#]/),C=x>0?t.substring(0,x):"",y=C;if(x>0&&n&&(y=/\{content\}/.test(n||"")?(n||"").replace(/\{content\}/g,C||""):(n||"")+C),_=t.split("").reverse().join(""),v=_.search(/[0-9\-\+#]/),m=w-v,m+="."===t.substring(m,m+1)?1:0,C=v>0?t.substring(m,w):"",b=C,""!==C&&r&&(b=/\{content\}/.test(r||"")?(r||"").replace(/\{content\}/g,C||""):C+(r||"")),t=t.substring(x,m),e="-"==t.charAt(0)?-e:+e,a=0>e?e=-e:0,i=t.match(/[^\d\-\+#]/g),l=i&&i[i.length-1]||".",o=i&&i[1]&&i[0]||",",t=t.split(l),e=e.toFixed(t[1]&&t[1].length),e=+e+"",h=t[1]&&t[1].lastIndexOf("0"),d=e.split("."),(!d[1]||d[1]&&d[1].length<=h)&&(e=(+e).toFixed(h+1)),c=t[0].split(o),t[0]=c.join(""),s=t[0]&&t[0].indexOf("0"),s>-1)for(;d[0].length<t[0].length-s;)d[0]="0"+d[0];else 0===+d[0]&&(d[0]="");if(e=e.split("."),e[0]=d[0],u=c[1]&&c[c.length-1].length){for(f=e[0],g="",p=f.length%u,w=f.length,m=0;w>m;m++)g+=f.charAt(m),!((m-p+1)%u)&&w-u>m&&(g+=o);e[0]=g}return e[1]=t[1]&&e[1]?l+e[1]:"",y+((a?"-":"")+e[0]+e[1])+b},e.equations={count:function(t){return t.length},sum:function(t){var e,n=t.length,r=0;for(e=0;n>e;e++)r+=t[e];return r},mean:function(t){var n=e.equations.sum(t);return n/t.length},median:function(t,e){var r,a=t.length;return a>1?(t.sort(function(t,e){return t-e}),r=Math.floor(a/2),a%2?t[r]:(t[r-1]+t[r])/2):n.invalid(e,"median",1)},mode:function(t){var e,n,r,a={},i=1,l=[t[0]];for(e=0;e<t.length;e++)n=t[e],a[n]=a[n]?a[n]+1:1,r=a[n],r>i?(l=[n],i=r):r===i&&(l.push(n),i=r);return l.sort(function(t,e){return t-e})},max:function(t){return Math.max.apply(Math,t)},min:function(t){return Math.min.apply(Math,t)},range:function(t){var e=t.sort(function(t,e){return t-e});return e[t.length-1]-e[0]},variance:function(t,r,a){for(var i,l=e.equations.mean(t),o=0,s=t.length;s--;)o+=Math.pow(t[s]-l,2);return i=t.length-(r?0:1),0===i?n.invalid(a,"variance",0):o/=i},varp:function(t,n){return e.equations.variance(t,!0,n)},vars:function(t,n){return e.equations.variance(t,!1,n)},stdevs:function(t,n){var r=e.equations.variance(t,!1,n);return Math.sqrt(r)},stdevp:function(t,n){var r=e.equations.variance(t,!0,n);return Math.sqrt(r)}},e.addWidget({id:"math",priority:100,options:{math_data:"math",math_ignore:[],math_mask:"#,##0.00",math_complete:null,math_priority:["row","above","below","col"],math_prefix:"",math_suffix:"",math_none:"N/A",math_event:"recalculate",math_rowFilter:""},init:function(t,r,a,i){var l=(e.hasWidget(t,"filter")?"filterEnd":"updateComplete")+".tsmath";n.events+=(e.hasWidget(t,"pager")?"pagerComplete":"filterEnd")+".tsmath ",a.$table.off((n.events+"updateComplete.tsmath "+i.math_event).replace(/\s+/g," ")).on(n.events+i.math_event,function(t){if(this.hasInitialized){var e="tablesorter-initialized"===t.type;(!i.math_isUpdating||e)&&(/filter/.test(t.type)||e||n.setColumnIndexes(a),n.recalculate(a,i,e))}}).on(l,function(){setTimeout(function(){n.updateComplete(a)},40)}),i.math_isUpdating=!1,t.hasInitialized&&n.recalculate(a,i,!0)},remove:function(t,e,r,a){a||e.$table.off((n.events+" updateComplete.tsmath "+r.math_event).replace(/\s+/g," ")).children().children("tr").children("[data-"+r.math_data+"]").empty()}})}(jQuery);
