<%= form_for(@category) do |f| %>

  <div class="field form-group">
    <h2>Catégorie : </h2>
<div class="row">
  <div class="col-md-4">
    <%= f.text_field :name, class: "form-control ", placeholder: "Nom(champ requis)", "data-id": "#{@category.id}" %>
  </div>
  <div class="col-md-4">
    <%= f.submit "", id: "sendButton", class: "btn btn-success btn-edit-category ", data: { confirm: 'Êtes vous sûr de vouloir editer cette catégorie ?' } %>
  </div>
</div>
    <% if @category.errors[:name].first != nil %>
    <div class="alert alert-danger ">
    <%= "Nom " + @category.errors[:name].first%><br>
      <% if @category.errors[:name].second != nil %>
        <%= "Nom " + @category.errors[:name].second%>
      <% end %>
  </div>
  <% end %>
    <% end %>

  </div><br>

  <div class="table-responsive">
    <table class="table table-hover">
      <thead class="header">
        <tr>
          <th>Sous-Catégorie</th>
          <th>Niveau d'urgence maximum</th>
          <th></th>
          <th></th>
        </tr>
      </thead>

      <tbody class="principal_body">
        <% @category.sous_categories.each do |sous_category| %>
        <tr>
          <% if !current_user.nil? && Right.where(name: "view_details_subcategories").pluck(current_user.tech.name).join('')  == 'true' %>
          <td onClick="document.location.href='<%=sous_category_path(sous_category)%>'"><%= sous_category.name %></td>
          <% else %>
          <td onClick="document.location.href='<%=sous_category_path(sous_category)%>'"><%= sous_category.name %></td>
          <% end %>
          <td onClick="document.location.href='<%=sous_category_path(sous_category)%>'"><%= sous_category.lvl_urgence_max %></td>

          <% if Right.where(name: "edit_subcategories").pluck(current_user.tech.name).join('')  == 'true' %>
          <td><%= link_to 'Editer', edit_sous_category_path(sous_category) %></td>
          <% end %>
          <% if Right.where(name: "delete_subcategories").pluck(current_user.tech.name).join('')  == 'true' %>
          <td><%= link_to 'Supprimer', sous_category, method: :delete, data: { confirm: 'Êtes vous VRAIMENT sûr de vouloir supprimer cette sous catégorie ? Non, je dis ça parce que si vous la supprimez et bien elle y sera plus ! Serieux !' }%></td>
          <% end %>
          <% end %>
        </tr>
            <tr class="formsnewsubcats">
            <%= simple_form_for(@sous_category) do |f| %>
            <td class='newsubcat'><%= f.text_field :name, class: "form-control ", placeholder: "Nom(Requis)", style: "margin-left:0px;"%></td>
            <td class='newsubcat'><%= select_tag "sous_category[lvl_urgence_max]", '<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10" selected="selected">10</option>'.html_safe, class: 'form-control ', style: "margin-left:0px;" %></td>
            <td class='newsubcat'><button class="btn btn-success > submit" id="sendSubCatButton">+</button></td>
            <td> </td>
            <% end %>
            <td colspan="2"></td>
          </tr>
      </tbody>
    </table>
  </div>
  <div class="actions">
  </div>
<script type="text/javascript">
  $("#sendSubCatButton").click(function(){
    var catId = $("#category_name").data("id");
    var subCatName = $("#sous_category_name").val();
    var lvlUrgenceMax = $("#sous_category_lvl_urgence_max option:selected").val();
    var data = { "data": {
              "name": subCatName,
              "category_id": catId,
              "lvl_urgence_max": lvlUrgenceMax
            }};

    // alert(catId);
    // alert(subCatName);
    // alert(lvlUrgenceMax);
    $.ajax({
      url: '/sous_categories',
      type: 'POST',
      contentType: 'application/json',
      dataType: 'json',
      data: JSON.stringify(data)
    });
  });
</script>
