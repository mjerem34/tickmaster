<%= form_for @incident, html: { multipart: true } do |f| %>
<br>
<div class="row">
<div class="col-md-4">
  <div class="field">
    <%= f.label "Catégorie", :class => ''  %><br>
    <%= select_tag "incident[category_id]", options_for_select(@categories.collect{|category| [category.name.titleize, category.id]}), {:class => "form-control ", include_blank: "", required: true}%><br>
    <%= select_tag "incident[sous_category_id]", options_for_select(@sous_categories.collect{|sous_category| [sous_category.name.titleize, sous_category.id]}), {:class => "form-control ", include_blank: "", required: true } %>
  </div>
    <br>
<script type="text/javascript">
  $(document).ready(function(){
    $("#incident_sous_category_id").hide();
    $("#incident_category_id").change(function(){
      $("#incident_sous_category_id").show(250);
    });
  });
</script>
    <div class="field">
      <%= f.label "Objet", :class => '' %><br>
      <%= f.text_field :title, :class => "form-control ", required: true  %>
      <% if @incident.errors[:title].first != nil %>
      <div class="alert alert-danger">
        <%= "Objet " + @incident.errors[:title].first%><br><br>
      </div>
      <% end %>
    </div><br>
  <div class="field"><br>
    <%= f.label "Niveau d'urgence", :class => ''  %><br>
    <div class="lvl_urgence_slider">
      <b>Bas</b><%= f.text_field :lvl_urgence_user, class: "slider-bootstrap", type: 'range', min: 0,max: 10, step: 1, value: 1 %><b>Haut</b><br><br>
      </div>
    </div>
    <div class="fallback" id="filesinputs">
    <div class="input-file-container js">
      <ul class=" js">
        <%= fields_for :file_incidents, @incident.file_incidents do |i| %>
        <li style="display:inline-block;"><%= i.file_field :file, name: "file_incidents[file][]",class: "js input-file", multiple: true %></li>
        <%= i.label "Selectionnez un fichier...", class: "js  label-file input-file-trigger", for: 'my-file', tabindex: '0' %><br>
        <li style="display:inline-block;"><button id="cancel_file_send" name="button" type="button" class='js btn  input-file-trigger'>Supprimer fichier</button></li>
        <% end %>
      </ul>
    </div>
  </div>
  <script type="text/javascript">
    $(document).ready(function(){
      $("#cancel_file_send").click(function(){
        $(".input-file").show();
        $(".label-file").text('Selectionnez des fichiers ...');
        reset($('.input-file'));
      });
    });

    window.reset = function (e) {
        e.wrap('<form>').closest('form').get(0).reset();
        e.unwrap();
    }
    $(document).ready(function(){
      $(".input-file").change(function(){
        var i = 0;
        var a = '';
        while( $('input[type=file]')[0].files[i].name !== '' ) {
          a += " " + $('input[type=file]')[0].files[i].name;
          i += 1;
          $(".label-file").text(a);
        }
      });
    });

  </script>

</div>


  <div class="col-md-8">
<div class="field">
  <%= f.cktext_area :content, :id => 'incident_content incident_content', ckeditor: {uiColor: '#DDDDDD'}, required: true %>
  <% if @incident.errors[:content].first != nil %>
  <div class="alert alert-danger">
    <%= "Description " + @incident.errors[:content].first %><br><br>
  </div>
  <% end %>
</div><br>
</div>
</div>

<div id="filelist">

</div>

<div class="actions">
  <ul class="buttons-edit-incident-right buttons">
    <li><%= f.submit "Valider", id: "sendButton", class: "btn btn-default btn-save " %></li>
    <li><%= link_to 'Annuler', current_user, class: "btn btn-default btn-cancel", data: { confirm: 'Êtes vous sûr de vouloir annuler (les modifications seront perdues) ?'}  %></li>
  </ul>



</div>
<% end %>
