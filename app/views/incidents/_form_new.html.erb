<%= form_for @incident, html: { multipart: true } do |f| %>
<br>
  <div class="row">

  <div class="field">
    <%= f.label "Catégorie", :class => 'form-interface'  %><br>
    <%= select_tag "incident[category_id]", options_for_select(@categories.collect{|category| [category.name.titleize, category.id]}), {:class => "form-control form-interface", include_blank: ""}%>
  </div>
</div>
<div class="row">
    <br>
    <div class="field">
    <%= f.label "Sous-Catégorie", :class => 'form-interface'  %><br>

    <%= select_tag "incident[sous_category_id]", options_for_select(@sous_categories.collect{|sous_category| [sous_category.name.titleize, sous_category.id]}), {:class => "form-control form-interface", include_blank: "" } %>
    <br>
  </div>
  </div>

  <div class="row">
    <div class="field">
      <%= f.label "Objet", :class => 'form-interface' %><br>
      <%= f.text_field :title, :class => "form-control form-interface"  %>
      <% if @incident.errors[:title].first != nil %>
      <div class="alert alert-danger">
        <%= "Objet " + @incident.errors[:title].first%><br><br>
      </div>
      <% end %>
    </div>
  </div><br>


<div class="field">
  <%= f.label "Description", :class => 'form-interface'  %><br>
  <%= f.cktext_area :content, :id => 'incident_content incident_content' %>
  <% if @incident.errors[:content].first != nil %>
  <div class="alert alert-danger">
    <%= "Description " + @incident.errors[:content].first %><br><br>
  </div>
  <% end %>
</div><br>
<div class="field"><br>
  <%= f.label "Niveau d'urgence", :class => 'form-interface'  %><br>
  <div class="form-interface">
    <b>Bas</b><%= text_field_tag "incident[lvl_urgence_user]", :class => 'form-interface slider-bootstrap' , type: 'range', data: {
      'slider-min' => 1,
      'slider-max' => 10,
      'slider-tooltip' => 'hide',
      'slider-step' => 1}%><b>Haut</b><br><br>
    </div>
  </div>
<script type="text/javascript">
$("#incident_lvl_urgence_user").slider();

</script>
<div class="input-file-container">
  <ul class="form-interface">
    <%= fields_for :file_incidents, @incident.file_incidents do |i| %>
    <li style="display:inline-block;"><%= i.file_field :file, name: "file_incidents[file][]", class: 'input-file', multiple: true%></li>
    <%= i.label "Selectionnez des fichiers ...", class: 'form-interface label-file input-file-trigger', for: 'my-file', tabindex: "0" %>
    <li style="display:inline-block;"><button id="cancel_file_send" name="button" type="button" class='btn form-interface input-file-trigger'>Supprimer fichier</button></li>
    <% end %>
  </ul>
</div>
<script type="text/javascript">
  $(document).ready(function(){
    $("#cancel_file_send").click(function(){
      $(".input-file").show();
      $(".label-file").text('Selectionnez des fichiers ...');
      reset($('.input-file'));
    });
  });

  window.reset = function (e) {
      e.wrap('<form>').closest('form').get(0).reset();
      e.unwrap();
  }
</script>
<div class="actions">
<%= f.submit "Envoyer", id: "sendButton", class: "btn btn-success btn-response", data: { confirm: 'Êtes vous sûr ?' } %>
</div>
<% end %>
<script type="text/javascript">
  function disableButton(id){
    id = document.getElementById(id);
    id.disabled = "disabled";
    id.value = "Envoi...";
  }

  $(document).ready(function(){
    $(".input-file").change(function(){
      var i = 0;
      var a = '';
      while( $('input[type=file]')[0].files[i].name !== '' ) {
        a += " " + $('input[type=file]')[0].files[i].name;
        i += 1;
        $(".label-file").text(a);
      }
    });
  });

document.querySelector("html").classList.add('js');

var fileInput  = document.querySelector( ".input-file" ),
  button     = document.querySelector( ".input-file-trigger" ),
  the_return = document.querySelector(".file-return");

button.addEventListener( "keydown", function( event ) {
  if ( event.keyCode == 13 || event.keyCode == 32 ) {
      fileInput.focus();
  }
});
button.addEventListener( "click", function( event ) {
 fileInput.focus();
 return false;
});
fileInput.addEventListener( "change", function( event ) {
  the_return.innerHTML = this.value;
});

</script>
