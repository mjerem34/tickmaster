<% @title = "Liste des incidents cloturés de #{current_user.surname} #{current_user.name}"%>
<div class="table-responsive">

  <table class="table table-hover">
    <thead class="header">
      <tr>
        <th>Objet</th>
        <th>Technicien</th>
        <th>Catégorie</th>
        <th>Date</th>
        <th>Etat</th>

      </tr>
    </thead>
    <% if @incidents.count > 0 %>
    <tbody>
      <% @incidents.order(["created_at desc"]).each do |incident| %>
      <tr style="background: #2c3e50; " data-toggle="modal" data-target="#<%= incident.id %>">
        <td><%= incident.title %></td>

        <% if incident.tech_id != nil %>
        <td><%= incident.tech.surname %>
          <%=incident.tech.name %></td>
      <% else %>
        <td>Technicien non défini ...</td>
        <% end %>

        <td><%= incident.category.name %></td>
        <td><%= incident.created_at.strftime("%d %b %Y") %></td>
        <% if current_user.tech.simple_user == true %>
        <td><%= incident.incident_state_id_for_user.shotcut %></td>
      <% else %>
        <td><%= incident.incident_state_id_for_tech.shortcut %></td>
        <% end %>
      </tr>
      <div class="container-modal">
        <!-- Modal -->
        <div class="modal fade" id="<%= incident.id %>" role="dialog">
          <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Détails de l'incident #
                  <%= incident.id %></h4>
              </div>
              <div class="modal-body">
                <p>Numéro : #
                  <%= incident.id %></p>
                <p>Objet :
                  <%= incident.title %></p>
                <p>Contenu :
                  <%= strip_tags(incident.content) %></p>
                <p>Demandeur :
                  <%= incident.user.name %>
                  <%=incident.user.surname%></p>
                <p>Technicien :
                  <% if incident.tech_id != nil %>
                  <% incident.tech.surname %>
                  <%=incident.tech.name %>
                <% else %>
                  Non défini
                  <% end %></p>
                <p>Catégorie :
                  <%= incident.category.name %></p>
                <p>Sous catégorie :
                  <%= incident.sous_category.name %></p>
                <p>Créé à :
                  <%= incident.created_at.strftime("%d %b %Y %H:%M") %></p>
                <p>Etat :
                  <% if current_user.tech.simple_user == true %>
                  <%= incident.incident_state_id_for_user.shotcut %>
                <% else %>
                  <%= incident.incident_state_id_for_tech.shortcut %>
                  <% end %></p>
              </div>
              <div class="modal-footer">
                <%= link_to "Détails", edit_incident_path(incident), class: "btn btn-primary"%>
                <button type="button" class="btn btn-danger" data-dismiss="modal">Fermer</button>
              </div>
            </div>

          </div>
        </div>

      </div>

      <% end %>
    </tbody>
  </table>

</div>
<% else %>
<div class="row">
  <div class="col-md-12 aucun-incident-div">
    <h1>
      Vous n'avez aucun incident actif pour le moment.
    </h1>
  </div>
</div>
<% end %>
<% else %>
